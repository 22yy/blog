# HTTP/1.1


## 相比HTTP/1.0改进
1. ⻓连接
   - HTTP/1.0 每发起⼀个请求，都要新建⼀次 TCP 连接（三次握⼿），⽽且是串⾏请求，增加了通信开销。
   - HTTP/1.1 采用⻓连接，也叫持久连接。只要任意⼀端没有明确提出断开连接，则保持 TCP 连接状态。  

2. 管道⽹络传输  
   - 在同⼀个 TCP 连接⾥⾯，客户端可以同时发起多个请求，只要第⼀个请求发出去了，不必等其回来，就可以发第二个请求出去，可以减少整体的响应时间。
   - 服务器则是按照请求顺序依次响应    

## 缺点

1. 队头阻塞
   - 发送的请求中有一个因为某种原因堵塞无法响应时，后面排队的请求也会被堵塞

2. 请求只能由客户端发送，服务器被动响应
3. 请求 / 响应头部（Header）未经压缩就发送，⾸部信息越多延迟越⼤。只能压缩 Body 的部分；
4. 发送冗⻓的⾸部。每次互相发送相同的⾸部造成的浪费较多
5. 没有请求优先级控制；


## 优化

### 避免发送HTTP请求
   - 利用**缓存**，如果每次请求的数据都是一样的，把这对「请求-响应」的数据用key-value的形式都缓存在本地，下次就直接读取本地的数据
   - 如果客户端从响应头部中发现响应过期，重新发送请求，请求的Etag头部带上第一次请求响应头部的摘要，服务器收到后，将本地资源的摘要与请求中的摘要作比较，如果不同则响应新的资源，相同则仅返回不含有包体的 304 Not Modified 响应，告诉客户端缓存仍然有效，可以减少响应资源在⽹络中传输的延时

### 减少HTTP请求次数
   - 减少重定向次数，将重定向的工作交给代理服务器
   - 合并请求：多个访问⼩⽂件的请求合并成⼀个⼤的请求
        - 将多个小图片用`CSS Image Sprites`合成为一个大图片，浏览器就⽤⼀次请求获得⼀个⼤图⽚，再根据 CSS 数据把⼤图⽚切割成多张⼩图⽚。
        - 可以将图⽚的⼆进制数据⽤ base64 编码后，以 URL 的形式潜⼊到 HTML ⽂件，跟随 HTML ⽂件⼀并发送.客户端收到 HTML 后，就可以直接解码出数据，然后直接显示图⽚，不用再发起图片相关请求
  - 按需访问
        - 请求⽹⻚的时候，只获取当前⽤户所看到的⻚⾯资源
        - 按需获取，来减少第⼀时间的 HTTP 请求次数。


### 减少 HTTP 响应的数据⼤⼩
  - 通过压缩响应资源，降低传输资源的⼤⼩，从⽽提⾼传输效率。